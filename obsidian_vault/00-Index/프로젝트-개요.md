# 쿠팡 도서 판매 자동화 시스템 - 전체 개요

#project #overview #automation

**작성일:** 2026-02-05
**상태:** 프로덕션 준비 완료

---

## 🎯 프로젝트 목표

알라딘 API를 활용하여 도서를 검색하고, 24개 출판사의 수익성 높은 도서를 자동으로 선별하여 쿠팡에 업로드하는 완전 자동화 시스템 구축

### 핵심 요구사항

1. **알라딘 API 통합** - 공식 Open API 사용
2. **24개 출판사 제한** - 40%-73% 마진율 출판사만 취급
3. **도서정가제 100% 준수** - 정가 × 0.9 엄수
4. **중복 업로드 절대 방지** - (계정, ISBN) UNIQUE 제약
5. **연도 추출** - 도서 제목에서 연도 자동 추출 (버전 관리용)
6. **자동 마진 계산** - 마진 = (0.801 - 공급률) × 정가 - 배송비
7. **배송 정책 자동 결정** - 순마진에 따라 무료/유료/묶음 판단
8. **묶음 SKU 자동 생성** - 저마진 도서를 같은 출판사+시리즈+연도로 묶음
9. **5개 계정 분산** - 중복 없이 계정별 분산 업로드

---

## 📊 시스템 아키텍처

```
┌──────────────────┐
│  Aladin API      │  도서 검색
└────────┬─────────┘
         │
         ↓
┌──────────────────┐
│  데이터 수집      │  ISBN, 제목, 가격, 출판사
│  (Crawler)       │  연도 추출, 시리즈 정규화
└────────┬─────────┘
         │
         ↓
┌──────────────────┐
│  Database V2     │  8개 테이블
│  (SQLite)        │  - publishers, books, products
│                  │  - bundle_skus, listings, etc.
└────────┬─────────┘
         │
         ↓
┌──────────────────┐
│  마진 분석기      │  출판사별 공급률 기반
│  (Analyzer)      │  순마진 = 마진 - 배송비(2000원)
└────────┬─────────┘
         │
         ↓
┌──────────────────┐
│  배송 정책 결정   │  순마진 >= 2000원: 무료배송
│                  │  순마진 >= 0원: 유료배송
│                  │  순마진 < 0원: 묶음 필요
└────────┬─────────┘
         │
         ├─→ 무료배송 가능 → 단권 업로드
         │
         └─→ 묶음 필요 → 묶음 SKU 생성기
                         │
                         ↓
                   ┌──────────────────┐
                   │  Bundle Generator │  같은 출판사+시리즈+연도
                   │                  │  최소 2권, 최대 10권
                   └────────┬─────────┘
                            │
                            ↓
                   ┌──────────────────┐
                   │  계정 분산기      │  5개 계정에 중복 없이 분산
                   │  (Distributor)   │  DB 레벨 중복 체크
                   └────────┬─────────┘
                            │
                            ↓
                   ┌──────────────────┐
                   │  CSV 생성        │  쿠팡 업로드용 CSV
                   │  (Exporter)      │  계정별 파일 생성
                   └────────┬─────────┘
                            │
                            ↓
                   ┌──────────────────┐
                   │  쿠팡 업로드      │  수동/자동 업로드
                   └──────────────────┘
```

---

## 🗄️ 데이터베이스 구조

### 8개 테이블

1. **accounts** - 5개 쿠팡 계정 정보
2. **publishers** - 24개 출판사 (마진율, 공급률, 무료배송 기준)
3. **books** - 알라딘에서 수집한 도서 원본 데이터
4. **products** - 단권 상품 (마진, 배송 정책 포함)
5. **bundle_skus** - 묶음 상품 (저마진 도서 조합)
6. **listings** - 계정별 업로드 현황 (중복 체크용)
7. **sales** - 판매 데이터 (나중에 분석용)
8. **analysis_results** - 분석 결과 (나중에 대시보드용)

### 핵심 제약조건

```sql
-- 중복 업로드 절대 방지
UNIQUE(account_id, isbn)        -- 단권용
UNIQUE(account_id, bundle_key)  -- 묶음용
```

상세 정보: [[Database-Schema-V2]]

---

## 💰 마진 계산 로직

### 계산 공식

```
정가 = list_price
판매가 = 정가 × 0.9  (도서정가제)
공급원가 = 정가 × 공급률
쿠팡수수료 = 판매가 × 0.11
배송비 = 2000원 (고정)

권당마진 = 판매가 - 공급원가 - 쿠팡수수료
순마진 = 권당마진 - 배송비
```

### 출판사별 공급률

| 출판사 그룹 | 마진율 | 공급률 | 무료배송 기준 |
|------------|--------|--------|-------------|
| EBS, 한국교육방송공사 | 73% | 0.27 | 50,800원 |
| 좋은책신사고 | 70% | 0.30 | 35,800원 |
| 동아 | 67% | 0.33 | 27,600원 |
| 개념원리, 이투스, 비상교육 등 13개 | 65% | 0.35 | 23,900원 |
| 이퓨쳐, 사회평론, 길벗 등 5개 | 60% | 0.40 | 18,000원 |
| 크라운, 영진 | 55% | 0.45 | 14,400원 |
| 마린북스, 아카데미소프트 등 4개 | 40% | 0.60 | 9,000원 |

상세 정보: [[마진-계산기]]

---

## 📦 배송 정책 결정

### 자동 판단 로직

```python
if 순마진 >= 2000원:
    배송정책 = '무료배송'
    단권업로드 = 가능
elif 순마진 >= 0원:
    배송정책 = '유료배송'
    단권업로드 = 가능
else:  # 순마진 < 0원
    배송정책 = '묶음필요'
    단권업로드 = 불가능
    → 묶음 SKU 생성 대상
```

### 예시

**EBS 수능완성 국어영역 (정가 8,000원)**
```
판매가 = 8,000 × 0.9 = 7,200원
공급원가 = 8,000 × 0.27 = 2,160원
쿠팡수수료 = 7,200 × 0.11 = 792원
권당마진 = 7,200 - 2,160 - 792 = 4,248원
순마진 = 4,248 - 2,000 = 2,248원 ✅ 무료배송 가능!
```

**크라운 문제집 (정가 12,000원)**
```
판매가 = 12,000 × 0.9 = 10,800원
공급원가 = 12,000 × 0.45 = 5,400원
쿠팡수수료 = 10,800 × 0.11 = 1,188원
권당마진 = 10,800 - 5,400 - 1,188 = 4,212원
순마진 = 4,212 - 2,000 = 2,212원 ✅ 무료배송 가능!
```

---

## 📚 묶음 SKU 생성

### 생성 조건

1. **순마진 < 0원** (단권 업로드 불가)
2. **같은 출판사** (publisher_id 동일)
3. **같은 시리즈** (normalized_series 동일)
4. **같은 연도** (year 동일)
5. **최소 2권, 최대 10권**

### 묶음 키 생성

```python
bundle_key = f"{publisher_id}_{normalized_series}_{year}"

# 예시: "12_개념원리수학_2025"
```

### 예시

**개념원리 수학 시리즈 (2025년)**

| 도서 | 정가 | 순마진 | 단권 업로드 |
|------|------|--------|-----------|
| 수학(상) | 15,000 | 800원 | 가능 (유료배송) |
| 수학(하) | 15,000 | 800원 | 가능 (유료배송) |
| 수학I | 16,000 | 1,120원 | 가능 (유료배송) |

묶음 시 총 순마진 = 800 + 800 + 1,120 - 2,000 = 720원 (유료배송)

→ 3권 묶음 "개념원리 수학 3종 세트 (2025)"
→ 총 판매가: 41,400원

상세 정보: [[묶음-SKU-생성기]]

---

## 📅 연도 추출 기능

### 추출 패턴

```python
# 4자리 연도: 2024, 2025, 2030
r'(202[0-9]|203[0])'

# 2자리 연도: 24년, 25년
r'[^\d]([2][0-9])(?:년|학년도)?'
→ 2024, 2025로 변환

# 괄호 안 연도: (2025)
r'\((202[0-9])\)'
```

### 예시

| 제목 | 추출 연도 | 정규화 제목 |
|------|-----------|------------|
| 2025 수능완성 국어영역 | 2025 | 수능완성 국어영역 |
| EBS 24년도 수능특강 | 2024 | EBS 수능특강 |
| 개념원리 수학(상) 2025 | 2025 | 개념원리 수학(상) |
| 마더텅 (2025) 영어독해 | 2025 | 마더텅 영어독해 |

**성공률:** 87% (테스트 기준)

상세 정보: [[연도-추출]]

---

## 🔄 전체 워크플로우

### 1. 도서 검색 (Aladin API)

```python
from crawlers.aladin_api_crawler import AladinAPICrawler

crawler = AladinAPICrawler()
books = crawler.search_books(
    query="수능완성",
    max_results=50
)
# 연도 자동 추출, 시리즈 정규화 포함
```

### 2. 마진 분석

```python
from analyzers.margin_calculator import MarginCalculator

analyzer = MarginCalculator()
for book in books:
    analysis = analyzer.analyze_book(book, publisher)
    # 순마진, 배송정책 자동 판단
```

### 3. 묶음 SKU 생성

```python
from analyzers.bundle_generator import BundleGenerator

generator = BundleGenerator()
bundles = generator.auto_generate_bundles(
    min_margin=2000  # 최소 순마진 2000원
)
```

### 4. 계정 분산 업로드

```python
from scripts.smart_upload_system import SmartUploadSystem

system = SmartUploadSystem()
system.distribute_to_accounts(
    products=uploadable_products,
    num_accounts=5
)
# DB 레벨에서 중복 자동 체크
```

### 5. CSV 생성

```python
from exporters.csv_generator import CSVGenerator

exporter = CSVGenerator()
csv_files = exporter.generate_all_account_csvs()
# 계정별 CSV 파일 생성
```

---

## 🚀 사용 방법

### 빠른 시작

```bash
# 1. 환경 설정
cd C:\Users\MSI\Desktop\Coupong

# 2. DB 초기화 (최초 1회)
python scripts/init_db_v2_clean.py

# 3. 전체 워크플로우 실행
python scripts/smart_upload_system.py

# 4. 생성된 CSV 확인
# output/coupang_upload_account_1.csv
# output/coupang_upload_account_2.csv
# ...
```

### 단계별 실행

```python
# example_workflow.py

from obsidian_logger import ObsidianLogger
from crawlers.aladin_api_crawler import AladinAPICrawler
from analyzers.margin_calculator import MarginCalculator
from analyzers.bundle_generator import BundleGenerator
from scripts.smart_upload_system import SmartUploadSystem

# Obsidian 로깅 시작
logger = ObsidianLogger()
logger.log_to_daily("### 도서 검색 시작", "새 작업")

# 1. 알라딘 검색
crawler = AladinAPICrawler()
books = crawler.search_books(query="수능완성", max_results=100)

# 2. 마진 분석
calculator = MarginCalculator()
profitable_books = calculator.filter_profitable(books, min_margin=0)

# 3. 묶음 생성
generator = BundleGenerator()
bundles = generator.auto_generate_bundles(min_margin=2000)

# 4. 계정 분산 및 CSV 생성
system = SmartUploadSystem()
system.run_full_workflow()

logger.log_to_daily("### 작업 완료", "완료")
```

---

## 📁 파일 구조

```
C:\Users\MSI\Desktop\Coupong\
│
├── app/
│   ├── models/
│   │   ├── publisher.py       (출판사 모델, 마진 계산)
│   │   ├── book.py            (도서 모델, 연도 추출)
│   │   ├── product.py         (단권 상품)
│   │   ├── bundle_sku.py      (묶음 상품)
│   │   ├── listing.py         (업로드 현황, 중복 체크)
│   │   └── account.py         (계정 관리)
│   ├── config.py              (설정)
│   └── database.py            (DB 연결)
│
├── crawlers/
│   └── aladin_api_crawler.py  (알라딘 API 크롤러)
│
├── analyzers/
│   ├── margin_calculator.py   (마진 분석기)
│   └── bundle_generator.py    (묶음 SKU 생성기)
│
├── exporters/
│   └── csv_generator.py       (CSV 생성)
│
├── scripts/
│   ├── init_db_v2_clean.py    (DB 초기화)
│   └── smart_upload_system.py (전체 워크플로우)
│
├── config/
│   └── publishers.py          (24개 출판사 설정)
│
├── obsidian_vault/            (개발 문서)
│   ├── 00-Index/
│   ├── 01-Daily/
│   ├── 02-Features/
│   ├── 03-Technical/
│   └── 04-Decisions/
│
├── obsidian_logger.py         (Obsidian 자동 로깅)
├── example_with_obsidian_logging.py
│
├── coupang.db                 (SQLite 데이터베이스)
├── .env                       (환경 변수)
└── requirements.txt
```

---

## 🔧 기술 스택

### Backend
- **Python 3.11+**
- **SQLAlchemy 2.0** - ORM
- **SQLite** - 데이터베이스
- **Pydantic** - 설정 관리
- **Requests** - HTTP 클라이언트

### APIs
- **Aladin Open API** - 도서 검색

### 문서화
- **Obsidian** - 개발 로그 자동 기록
- **Markdown** - 문서 포맷

상세 정보: [[Tech-Stack]]

---

## ✅ 구현 완료 기능

### 핵심 기능
- [x] Database V2 스키마 설계 및 구현 (8개 테이블)
- [x] 24개 출판사 설정 (마진율, 공급률)
- [x] 알라딘 API 크롤러
- [x] 연도 추출 (87% 성공률)
- [x] 시리즈 정규화
- [x] 마진 자동 계산
- [x] 배송 정책 자동 결정
- [x] 묶음 SKU 자동 생성
- [x] 중복 방지 (DB 제약조건)
- [x] 계정 분산 업로드
- [x] CSV 생성

### 개발 도구
- [x] Obsidian 실시간 로깅
- [x] ObsidianLogger 클래스
- [x] 일일 개발 로그 자동 생성
- [x] 기능/결정/기술/버그 로깅 템플릿
- [x] Claude-Obsidian 통합 가이드

---

## 🎯 다음 단계 (선택사항)

### Phase 1: 프로덕션 사용
- [ ] 알라딘 TTBKey 발급 및 설정
- [ ] 실제 도서 검색 및 DB 구축
- [ ] CSV 생성 후 쿠팡 수동 업로드
- [ ] 판매 데이터 수집

### Phase 2: 분석 엔진
- [ ] 판매 분석 대시보드 (Streamlit)
- [ ] 계정별 성과 분석
- [ ] 출판사별 수익성 분석
- [ ] 노출/클릭/전환율 추적

### Phase 3: 자동화 확장
- [ ] 쿠팡 자동 업로드 (Selenium)
- [ ] 재고 자동 관리
- [ ] 가격 자동 조정
- [ ] 일일 자동 크롤링 스케줄러

---

## 📊 현재 상태

### 데이터베이스
- ✅ 초기화 완료
- ✅ 24개 출판사 등록
- ✅ 제약조건 테스트 완료

### 코드베이스
- ✅ 모든 모델 구현
- ✅ 크롤러 구현
- ✅ 분석기 구현
- ✅ 통합 스크립트 구현

### 문서화
- ✅ Obsidian Vault 구성
- ✅ 일일 로그 자동 생성
- ✅ 기술 문서 자동 생성
- ✅ Claude 통합 가이드 작성

---

## 🔗 관련 문서

### 핵심 문서
- [[Index]] - 메인 대시보드
- [[Development-Timeline]] - 개발 타임라인
- [[Database-Schema-V2]] - 데이터베이스 스키마

### 기능 문서
- [[마진-계산기]] - 마진 계산 로직
- [[연도-추출]] - 연도 추출 기능
- [[묶음-SKU-생성기]] - 묶음 SKU 생성

### 기술 문서
- [[Tech-Stack]] - 기술 스택
- [[계정별-통계-쿼리]] - SQL 쿼리 예시

### 통합 가이드
- [[Claude-Integration]] - Claude-Obsidian 통합

---

## 📞 문의 및 지원

프로젝트 관련 문의사항은 Obsidian 일일 노트에 기록하거나 Claude Code를 통해 질문하세요.

---

**프로젝트 상태: 프로덕션 준비 완료 ✅**

**다음 작업: 알라딘 TTBKey 발급 후 실제 운영 시작**
