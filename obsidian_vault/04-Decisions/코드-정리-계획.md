# 코드 정리 계획 (Phase 1.5)

#decision #cleanup #plan

**작성일:** 2026-02-05
**목적:** Phase 2 개발 전 기술 부채 정리

---

## 원칙

- **돌아가는 코드는 건드리지 않는다**
- 리팩토링 아님, 청소임
- 삭제 > 수정 (안 쓰는 건 지운다)
- 한 번에 하나씩, 커밋 단위로

---

## 1단계: 죽은 파일 삭제

안 쓰는 파일을 제거한다. 파이프라인에 영향 없음.

| 파일 | 이유 | 안전? |
|------|------|:-----:|
| `crawlers/kyobo_crawler.py` | Kyobo 안 씀 (알라딘만 사용) | ✅ |
| `crawlers/kyobo_crawler_v2.py` | 위와 동일 | ✅ |
| `crawlers/kyobo_simple_crawler.py` | 위와 동일 | ✅ |
| `app/models/kyobo_product.py` | 레거시 모델, Book으로 대체됨 | ✅ |
| `scripts/init_db.py` | init_db_v2_clean.py로 대체 | ✅ |
| `scripts/init_db_v2.py` | init_db_v2_clean.py로 대체 | ✅ |
| `scripts/debug_kyobo.py` | Kyobo 디버그용, 안 씀 | ✅ |
| `scripts/inspect_kyobo.py` | Kyobo 검사용, 안 씀 | ✅ |
| `example_with_obsidian_logging.py` | 예제 파일, 불필요 | ✅ |
| `example_auto_logging.py` | 예제 파일, 불필요 | ✅ |

**삭제 전 확인:** 각 파일이 import되는 곳이 없는지 grep으로 검증

---

## 2단계: 미커밋 파일 git add

현재 git에 안 올라간 핵심 파일들을 커밋한다.

| 파일 | 중요도 |
|------|--------|
| `scripts/run_pipeline.py` | 메인 파이프라인 (필수) |
| `scripts/import_existing_products.py` | 상품 import (필수) |
| `scripts/obsidian_hook.py` | Obsidian 연동 |
| `dashboard/app.py` | Streamlit 대시보드 |
| `dashboard/pages/1_📊_계정_현황.py` | 대시보드 페이지 |
| `dashboard/pages/2_📦_상품_관리.py` | 대시보드 페이지 |
| `CLAUDE.md` | Claude 지시사항 |

**제외 (커밋 안 함):**
- `coupang_auto.db.bak` → .gitignore에 추가
- `~$북마트 007bm.xlsx` → 임시 파일
- `nul` → Windows 아티팩트

---

## 3단계: 빈 디렉토리 정리

| 디렉토리 | 처리 |
|-----------|------|
| `app/api/` | 삭제 (FastAPI 안 씀) |
| `app/schemas/` | 삭제 (Pydantic 안 씀) |
| `app/tasks/` | 삭제 (Celery 안 씀) |
| `dashboard/components/` | 삭제 (비어있음) |

---

## 4단계: 매직넘버 상수화

`app/constants.py` 신규 생성:

```python
# 도서정가제
BOOK_DISCOUNT_RATE = 0.9       # 정가 × 0.9 = 판매가

# 쿠팡
COUPANG_FEE_RATE = 0.11        # 판매가의 11%
DEFAULT_SHIPPING_COST = 2000    # 기본 배송비 (원)
FREE_SHIPPING_THRESHOLD = 2000  # 무료배송 순마진 기준 (원)

# 재고
DEFAULT_STOCK = 10              # 기본 재고 수량
DEFAULT_LEAD_TIME = 2           # 출고 소요일

# API
API_THROTTLE_SECONDS = 1.0     # 알라딘 API 호출 간격
```

기존 코드에서 하드코딩된 숫자를 이 상수로 교체한다.

---

## 5단계: .gitignore 보강

추가할 패턴:
```
*.bak
~$*
nul
.claude/projects/
```

---

## 작업 순서

```
1단계 (삭제) → 커밋
2단계 (git add) → 커밋
3단계 (빈 디렉토리) → 커밋
4단계 (상수화) → 커밋
5단계 (.gitignore) → 커밋
```

각 단계별 독립 커밋. 문제 생기면 revert 가능.

---

## 하지 않는 것

- 순환 import 해결 (동작에 문제 없음, Phase 2에서 필요시 처리)
- 에러 핸들링 추가 (Phase 2 기능 개발하면서 같이)
- 테스트 작성 (Phase 2 기능 단위로 작성)
- 업로더 통합 (Phase 2에서 Playwright만 쓸 거니까 그때)

---

## 예상 결과

| Before | After |
|--------|-------|
| Python 파일 71개 | ~58개 (-13) |
| 미커밋 핵심 파일 6개 | 0개 |
| 빈 디렉토리 4개 | 0개 |
| 매직넘버 10+ 곳 | constants.py 1곳 |

---

## 관련 문서

- [[Dashboard]] - 현재 프로젝트 상태
- [[Development-Timeline]] - Phase 1.5로 기록 예정
