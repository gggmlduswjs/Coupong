# Claude와의 대화 - 매출 분석 대시보드 구현

#conversation #revenue #dashboard #wing-api

**날짜:** 2026-02-05
**주제:** WING Revenue History API 연동 + 매출 분석 대시보드 전체 구현

---

## 대화 개요

쿠팡 WING Revenue History API를 활용해 5개 계정의 매출 데이터를 수집하고, Streamlit 대시보드에 매출 분석 페이지를 추가하는 작업을 진행했다. DB 모델 설계부터 동기화 스크립트, 대시보드 UI까지 전체 구현.

## 진행 과정

1. **설계 단계**: revenue_history 테이블 스키마 설계 (주문-아이템 단위, Sales 테이블과 분리)
2. **WING Client 확장**: `get_revenue_history()`, `get_all_revenue_history()` 메서드 추가
3. **RevenueHistory 모델**: SQLAlchemy 모델 생성, `__init__.py` 등록
4. **sync_revenue.py**: RevenueSync 클래스 구현 (31일 윈도우 분할, listing 매칭, INSERT OR IGNORE)
5. **대시보드 UI**: KPI 카드, 일별 추이, 계정별 비교, 베스트셀러, 광고 우선순위

## 주요 결정/결과

- revenue_history를 Sales와 별도 테이블로 설계 (주문-아이템 단위 원본 보존)
- 31일 단위 윈도우 분할로 API 제한 대응
- UNIQUE(account_id, order_id, vendor_item_id)로 재실행 시 중복 방지
- listing_id 매칭으로 출판사별 분석 가능

## 변경된 파일

- `app/api/coupang_wing_client.py` — revenue history 메서드 2개 추가
- `app/models/revenue_history.py` — 신규 생성
- `app/models/__init__.py` — RevenueHistory import 추가
- `scripts/sync_revenue.py` — 신규 생성 (RevenueSync 클래스)
- `dashboard.py` — "매출 분석" 메뉴 + 전체 UI 추가

## 관련 문서

- [[매출-분석-대시보드]]
- [[쿠팡-API-연동]]
- [[Database-Schema-V2]]
