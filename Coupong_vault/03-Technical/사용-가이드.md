# ì‚¬ìš© ê°€ì´ë“œ

#guide #usage #howto

**ì‘ì„±ì¼:** 2026-02-05

---

## ë¹ ë¥¸ ì‹œì‘

### 1ë‹¨ê³„: ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰

```bash
cd C:\Users\MSI\Desktop\Coupong

# ì „ì²´ 6ë‹¨ê³„ íŒŒì´í”„ë¼ì¸ (DB ì´ˆê¸°í™” â†’ í¬ë¡¤ë§ â†’ ë¶„ì„ â†’ ë™ê¸°í™” â†’ CSV)
python scripts/run_pipeline.py --max-results 50

# íŠ¹ì • ì¶œíŒì‚¬ë§Œ
python scripts/run_pipeline.py --publishers ê°œë…ì›ë¦¬ ê¸¸ë²—

# ë¯¸ë¦¬ë³´ê¸° (ì €ì¥ ì•ˆ í•¨)
python scripts/run_pipeline.py --dry-run
```

íŒŒì´í”„ë¼ì¸ 6ë‹¨ê³„:
```
Stage 1: DB ì´ˆê¸°í™” (í…Œì´ë¸” ìƒì„± + ALTER TABLE ë§ˆì´ê·¸ë ˆì´ì…˜)
Stage 2: ì¶œíŒì‚¬ 24ê°œ + ê³„ì • 5ê°œ ì‹œë”© (WING API ì—°ê²° í™•ì¸)
Stage 3: ì•Œë¼ë”˜ API ê²€ìƒ‰ (ì¶œíŒì‚¬ë‹¹ ìµœëŒ€ 50ê±´)
Stage 4: ë§ˆì§„ ë¶„ì„ + ë¬¶ìŒ SKU ìƒì„±
Stage 5: WING API ìƒí’ˆ ë™ê¸°í™” (5ê³„ì • ê¸°ì¡´ ìƒí’ˆ ë°˜ì˜)
Stage 6: CSV ìƒì„± (ê³„ì •ë³„ ì¤‘ë³µ ì œì™¸)
```

### 2ë‹¨ê³„: WING API ìƒí’ˆ ë™ê¸°í™” (ë³„ë„ ì‹¤í–‰)

```bash
# ì „ì²´ 5ê³„ì • ë™ê¸°í™”
python scripts/sync_coupang_products.py

# íŠ¹ì • ê³„ì •ë§Œ
python scripts/sync_coupang_products.py --account 007-bm
```

### 3ë‹¨ê³„: API ìƒí’ˆ ë“±ë¡

```bash
# ë‹¨ê±´ ë“±ë¡ í…ŒìŠ¤íŠ¸
python scripts/test_api_upload.py --account 007-book --isbn 9788961334839

# dry-run (í˜ì´ë¡œë“œë§Œ í™•ì¸, ì‹¤ì œ ë“±ë¡ ì•ˆ í•¨)
python scripts/test_api_upload.py --dry-run
```

### 4ë‹¨ê³„: ìƒì„±ëœ CSV í™•ì¸

```
output/
  â”œâ”€â”€ coupang_upload_007-book.csv
  â”œâ”€â”€ coupang_upload_007-bm.csv
  â”œâ”€â”€ coupang_upload_007-ez.csv
  â”œâ”€â”€ coupang_upload_002-bm.csv
  â””â”€â”€ coupang_upload_big6ceo.csv
```

---

## ğŸ“– ìƒì„¸ ê°€ì´ë“œ

### ì‹œë‚˜ë¦¬ì˜¤ 1: íŠ¹ì • í‚¤ì›Œë“œë¡œ ë„ì„œ ê²€ìƒ‰ ë° ì—…ë¡œë“œ

```python
# example_search.py

from crawlers.aladin_api_crawler import AladinAPICrawler
from analyzers.margin_calculator import MarginCalculator
from analyzers.bundle_generator import BundleGenerator
from scripts.smart_upload_system import SmartUploadSystem
from app.database import get_db

# 1. ì•Œë¼ë”˜ ê²€ìƒ‰
crawler = AladinAPICrawler()
books = crawler.search_books(
    query="ìˆ˜ëŠ¥ì™„ì„±",
    max_results=100
)
print(f"ê²€ìƒ‰ ê²°ê³¼: {len(books)}ê¶Œ")

# 2. DB ì €ì¥
db = next(get_db())
for book_data in books:
    book = Book(**book_data)
    db.add(book)
db.commit()

# 3. ë§ˆì§„ ë¶„ì„
calculator = MarginCalculator(db)
products = calculator.analyze_all_books()
print(f"ë¶„ì„ ì™„ë£Œ: {len(products)}ê°œ ìƒí’ˆ")

# 4. ë¬¶ìŒ ìƒì„±
generator = BundleGenerator(db)
bundles = generator.auto_generate_bundles(min_margin=2000)
print(f"ë¬¶ìŒ ìƒì„±: {len(bundles)}ê°œ")

# 5. ê³„ì • ë¶„ì‚°
system = SmartUploadSystem(db)
system.distribute_to_accounts(products + bundles)
print("ê³„ì • ë¶„ì‚° ì™„ë£Œ")

# 6. CSV ìƒì„±
from exporters.csv_generator import CSVGenerator
exporter = CSVGenerator(db)
csv_files = exporter.generate_all_account_csvs()
print(f"CSV ìƒì„±: {len(csv_files)}ê°œ íŒŒì¼")
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: íŠ¹ì • ì¶œíŒì‚¬ë§Œ ê²€ìƒ‰

```python
# example_publisher.py

from app.database import get_db
from app.models import Publisher, Book

db = next(get_db())

# EBS ì¶œíŒì‚¬ë§Œ ê²€ìƒ‰
ebs = db.query(Publisher).filter(
    Publisher.name.in_(["EBS", "í•œêµ­êµìœ¡ë°©ì†¡ê³µì‚¬"])
).all()

print(f"EBS ì¶œíŒì‚¬: {len(ebs)}ê°œ")
for pub in ebs:
    print(f"- {pub.name}: ë§ˆì§„ìœ¨ {pub.margin_rate}%")

# EBS ë„ì„œ ê²€ìƒ‰
crawler = AladinAPICrawler()
ebs_books = crawler.search_books(query="EBS ìˆ˜ëŠ¥", max_results=50)

print(f"EBS ë„ì„œ: {len(ebs_books)}ê¶Œ")
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 3: ë§ˆì§„ ë¶„ì„ë§Œ ì‹¤í–‰

```python
# example_margin_analysis.py

from analyzers.margin_calculator import MarginCalculator
from app.database import get_db
from app.models import Book, Publisher

db = next(get_db())

# ë¯¸ë¶„ì„ ë„ì„œ ì¡°íšŒ
unprocessed_books = db.query(Book).filter(
    Book.is_processed == False
).all()

print(f"ë¯¸ë¶„ì„ ë„ì„œ: {len(unprocessed_books)}ê¶Œ")

# ë§ˆì§„ ë¶„ì„
calculator = MarginCalculator(db)
for book in unprocessed_books:
    publisher = db.query(Publisher).filter(
        Publisher.name == book.publisher_name
    ).first()

    if publisher:
        analysis = calculator.analyze_book(book, publisher)
        print(f"{book.title}: ìˆœë§ˆì§„ {analysis['net_margin']:,}ì›")

        # ìƒí’ˆ ìƒì„±
        product = Product.create_from_book(book, publisher)
        db.add(product)

        # ì²˜ë¦¬ ì™„ë£Œ ë§ˆí¬
        book.is_processed = True

db.commit()
print("ë§ˆì§„ ë¶„ì„ ì™„ë£Œ")
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 4: ë¬¶ìŒ SKUë§Œ ìƒì„±

```python
# example_bundles.py

from analyzers.bundle_generator import BundleGenerator
from app.database import get_db

db = next(get_db())

# ë¬¶ìŒ ìƒì„±ê¸° ì´ˆê¸°í™”
generator = BundleGenerator(db)

# ë¬¶ìŒ ê°€ëŠ¥í•œ ê·¸ë£¹ ì°¾ê¸°
groups = generator.find_bundleable_books(
    min_books=2,  # ìµœì†Œ 2ê¶Œ
    max_books=5   # ìµœëŒ€ 5ê¶Œ
)

print(f"ë¬¶ìŒ ê°€ëŠ¥ ê·¸ë£¹: {len(groups)}ê°œ")
for bundle_key, books in groups.items():
    print(f"- {bundle_key}: {len(books)}ê¶Œ")

# ìë™ ë¬¶ìŒ ìƒì„± (ìˆœë§ˆì§„ 2000ì› ì´ìƒ)
bundles = generator.auto_generate_bundles(min_margin=2000)

print(f"\nìƒì„±ëœ ë¬¶ìŒ: {len(bundles)}ê°œ")
for bundle in bundles:
    print(f"- {bundle.bundle_name}")
    print(f"  ê¶Œìˆ˜: {bundle.book_count}ê¶Œ")
    print(f"  íŒë§¤ê°€: {bundle.total_sale_price:,}ì›")
    print(f"  ìˆœë§ˆì§„: {bundle.net_margin:,}ì›")
    print()
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 5: ê³„ì •ë³„ ì—…ë¡œë“œ í˜„í™© í™•ì¸

```python
# example_check_listings.py

from app.database import get_db
from app.models import Account, Listing
from sqlalchemy import func

db = next(get_db())

# ê³„ì •ë³„ í†µê³„
accounts = db.query(Account).all()

print("ê³„ì •ë³„ ì—…ë¡œë“œ í˜„í™©:\n")
for account in accounts:
    # ì—…ë¡œë“œ ê°œìˆ˜
    count = db.query(Listing).filter(
        Listing.account_id == account.id
    ).count()

    # ìƒí’ˆ íƒ€ì…ë³„ ê°œìˆ˜
    single_count = db.query(Listing).filter(
        Listing.account_id == account.id,
        Listing.product_type == 'single'
    ).count()

    bundle_count = db.query(Listing).filter(
        Listing.account_id == account.id,
        Listing.product_type == 'bundle'
    ).count()

    print(f"{account.account_name}:")
    print(f"  ì´ ì—…ë¡œë“œ: {count}ê°œ")
    print(f"  - ë‹¨ê¶Œ: {single_count}ê°œ")
    print(f"  - ë¬¶ìŒ: {bundle_count}ê°œ")
    print()
```

ì¶œë ¥:
```
ê³„ì •ë³„ ì—…ë¡œë“œ í˜„í™©:

account_1:
  ì´ ì—…ë¡œë“œ: 18ê°œ
  - ë‹¨ê¶Œ: 15ê°œ
  - ë¬¶ìŒ: 3ê°œ

account_2:
  ì´ ì—…ë¡œë“œ: 20ê°œ
  - ë‹¨ê¶Œ: 18ê°œ
  - ë¬¶ìŒ: 2ê°œ

...
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 6: íŠ¹ì • ê³„ì •ì— ìˆ˜ë™ í• ë‹¹

```python
# example_manual_assign.py

from app.database import get_db
from app.models import Product, Account, Listing

db = next(get_db())

# account_1ì— íŠ¹ì • ìƒí’ˆ í• ë‹¹
account = db.query(Account).filter(
    Account.account_name == "account_1"
).first()

# ë¬´ë£Œë°°ì†¡ ê°€ëŠ¥í•œ ìƒí’ˆ ì¤‘ ë¯¸ì—…ë¡œë“œëœ ê²ƒ
available_products = db.query(Product).filter(
    Product.shipping_policy == 'free',
    Product.status == 'ready',
    Product.isbn.notin_(
        db.query(Listing.isbn).filter(
            Listing.account_id == account.id
        )
    )
).limit(10).all()

# í• ë‹¹
for product in available_products:
    listing = Listing(
        account_id=account.id,
        product_type='single',
        product_id=product.id,
        isbn=product.isbn,
        sale_price=product.sale_price,
        shipping_policy=product.shipping_policy
    )
    db.add(listing)

db.commit()
print(f"{len(available_products)}ê°œ ìƒí’ˆ í• ë‹¹ ì™„ë£Œ")
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 7: CSV ì¬ìƒì„±

```python
# example_regenerate_csv.py

from exporters.csv_generator import CSVGenerator
from app.database import get_db

db = next(get_db())

# ì „ì²´ ê³„ì • CSV ì¬ìƒì„±
exporter = CSVGenerator(db)
csv_files = exporter.generate_all_account_csvs()

print(f"ìƒì„±ëœ CSV: {len(csv_files)}ê°œ")
for csv_file in csv_files:
    print(f"- {csv_file}")

# íŠ¹ì • ê³„ì •ë§Œ ìƒì„±
account_1_csv = exporter.generate_account_csv(account_id=1)
print(f"\naccount_1 CSV: {account_1_csv}")
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 8: Obsidian ë¡œê¹… í™œìš©

```python
# example_with_logging.py

from obsidian_logger import ObsidianLogger
from crawlers.aladin_api_crawler import AladinAPICrawler

# ë¡œê±° ì´ˆê¸°í™”
logger = ObsidianLogger()

# ì‘ì—… ì‹œì‘
logger.log_to_daily("### ì•Œë¼ë”˜ í¬ë¡¤ë§ ì‹œì‘", "ì‘ì—… ì‹œì‘")

# í¬ë¡¤ë§
crawler = AladinAPICrawler()
books = crawler.search_books(query="ê°œë…ì›ë¦¬", max_results=50)

# ë¡œê·¸ ê¸°ë¡
logger.log_to_daily(
    f"ê²€ìƒ‰ ì™„ë£Œ: {len(books)}ê¶Œ",
    "ê²€ìƒ‰ ê²°ê³¼"
)

# ê¸°ëŠ¥ ë¡œê·¸
logger.log_feature(
    feature_name="ì•Œë¼ë”˜ ê²€ìƒ‰",
    description=f"ê°œë…ì›ë¦¬ í‚¤ì›Œë“œë¡œ {len(books)}ê¶Œ ê²€ìƒ‰ ì™„ë£Œ",
    tags=["crawler", "aladin"],
    status="completed"
)

# ê¸°ìˆ  ë¬¸ì„œ ìƒì„±
logger.log_technical(
    tech_name="ê²€ìƒ‰ ê²°ê³¼ í†µê³„",
    content=f"""
    ## ê²€ìƒ‰ í†µê³„
    - í‚¤ì›Œë“œ: ê°œë…ì›ë¦¬
    - ê²°ê³¼: {len(books)}ê¶Œ
    - í‰ê·  ê°€ê²©: {sum(b['list_price'] for b in books) // len(books):,}ì›
    """,
    tags=["statistics", "search"]
)
```

---

## ğŸ”§ ìœ ì§€ë³´ìˆ˜

### DB ë°±ì—…

```bash
# SQLite DB ë°±ì—…
copy coupang.db coupang_backup_20260205.db
```

### DB ì´ˆê¸°í™” (ì „ì²´ ì‚­ì œ)

```bash
# ì£¼ì˜: ëª¨ë“  ë°ì´í„° ì‚­ì œë¨!
del coupang.db
python scripts/init_db_v2_clean.py
```

### íŠ¹ì • í…Œì´ë¸”ë§Œ ì´ˆê¸°í™”

```python
# example_reset_listings.py

from app.database import get_db, engine
from app.models import Listing

db = next(get_db())

# listings í…Œì´ë¸” ì „ì²´ ì‚­ì œ
db.query(Listing).delete()
db.commit()

print("listings í…Œì´ë¸” ì´ˆê¸°í™” ì™„ë£Œ")
```

---

## ğŸ› ë¬¸ì œ í•´ê²°

### ë¬¸ì œ 1: "Module not found" ì—ëŸ¬

```bash
# ê²½ë¡œ í™•ì¸
import sys
print(sys.path)

# í”„ë¡œì íŠ¸ ë£¨íŠ¸ê°€ ì—†ë‹¤ë©´ ì¶”ê°€
import sys
from pathlib import Path
project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root))
```

### ë¬¸ì œ 2: DB ì œì•½ì¡°ê±´ ìœ„ë°˜

```python
from sqlalchemy.exc import IntegrityError

try:
    listing = Listing(account_id=1, isbn="9788...")
    db.add(listing)
    db.commit()
except IntegrityError as e:
    db.rollback()
    print(f"ì¤‘ë³µ ì—…ë¡œë“œ ì‹œë„: {e}")
```

### ë¬¸ì œ 3: API íƒ€ì„ì•„ì›ƒ

```python
# íƒ€ì„ì•„ì›ƒ ì„¤ì •
crawler = AladinAPICrawler()
books = crawler.search_books(
    query="ìˆ˜ëŠ¥ì™„ì„±",
    max_results=50,
    timeout=30  # 30ì´ˆ
)
```

### ë¬¸ì œ 4: CSV ì¸ì½”ë”© ë¬¸ì œ

```python
# UTF-8 with BOM (Excel í˜¸í™˜)
import csv

with open('output.csv', 'w', encoding='utf-8-sig', newline='') as f:
    writer = csv.writer(f)
    writer.writerows(data)
```

---

## ğŸ“Š ì„±ëŠ¥ íŒ

### íŒ 1: ë°°ì¹˜ ì²˜ë¦¬

```python
# Bad: ê±´ë³„ ì»¤ë°‹
for book in books:
    db.add(book)
    db.commit()  # ëŠë¦¼!

# Good: ë°°ì¹˜ ì»¤ë°‹
for book in books:
    db.add(book)
db.commit()  # í•œ ë²ˆë§Œ
```

### íŒ 2: í•„ìš”í•œ í•„ë“œë§Œ ì¡°íšŒ

```python
# Bad: ì „ì²´ ì¡°íšŒ
books = db.query(Book).all()

# Good: í•„ìš”í•œ ì»¬ëŸ¼ë§Œ
book_titles = db.query(Book.title, Book.isbn).all()
```

### íŒ 3: ì¸ë±ìŠ¤ í™œìš©

```python
# ì¸ë±ìŠ¤ê°€ ìˆëŠ” ì»¬ëŸ¼ìœ¼ë¡œ ê²€ìƒ‰
books = db.query(Book).filter(
    Book.isbn == "9788..."  # isbnì— ì¸ë±ìŠ¤ ìˆìŒ
).first()
```

---

## ğŸ¯ ëª¨ë²” ì‚¬ë¡€

### 1. í•­ìƒ try-except ì‚¬ìš©

```python
try:
    # ìœ„í—˜í•œ ì‘ì—…
    db.commit()
except Exception as e:
    db.rollback()
    logger.error(f"ì—ëŸ¬ ë°œìƒ: {e}")
```

### 2. ë¡œê¹… í™œìš©

```python
import logging

logger = logging.getLogger(__name__)
logger.info("ì‘ì—… ì‹œì‘")
logger.error("ì—ëŸ¬ ë°œìƒ", exc_info=True)
```

### 3. í™˜ê²½ ë³€ìˆ˜ ì‚¬ìš©

```python
# .env íŒŒì¼
ALADIN_TTB_KEY=your_key_here
DB_PATH=coupang.db

# Python
from app.config import settings
ttb_key = settings.aladin_ttb_key
```

### 4. í…ŒìŠ¤íŠ¸ ì‘ì„±

```python
def test_margin_calculation():
    publisher = Publisher(supply_rate=0.27)
    result = publisher.calculate_margin(8000)
    assert result['net_margin'] == 2248
```

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- [[í”„ë¡œì íŠ¸-ê°œìš”]] - í”„ë¡œì íŠ¸ ì „ì²´ ê°œìš”
- [[ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜]] - ì‹œìŠ¤í…œ êµ¬ì¡°
- [[Database-Schema-V2]] - DB ìŠ¤í‚¤ë§ˆ
- [[Tech-Stack]] - ê¸°ìˆ  ìŠ¤íƒ

---

## ğŸ“ ì¶”ê°€ ë„ì›€

- Obsidian ì¼ì¼ ë…¸íŠ¸ì— ì§ˆë¬¸ ê¸°ë¡
- Claude Codeì—ê²Œ ì§ˆë¬¸
- ê´€ë ¨ ë¬¸ì„œ ì°¸ì¡°

---

**ì—…ë°ì´íŠ¸:** 2026-02-05
**ìƒíƒœ:** ì‚¬ìš© ê°€ëŠ¥
