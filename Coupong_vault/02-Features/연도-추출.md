# 연도 추출

#feature #parser #regex

**상태:** ✅ 완료
**구현 파일:** `app/models/book.py` → `Book.extract_year()`

---

## 개요

도서 제목에서 출판 연도를 자동 추출한다. 같은 시리즈의 연도별 묶음 생성에 필수적인 전처리 단계. 성공률 87%.

## 인식 패턴

### 4자리 연도 (2020~2030)
```
"2025 수능완성"       → 2025
"개념원리 수학 2024"  → 2024
```

### 2자리 연도 (20~29 → 2000 + n)
```
"24년도 교재"   → 2024
"25학년도 수능" → 2025
```

## 핵심 로직 (extract_year)

```python
@staticmethod
def extract_year(title: str) -> int:
    # 1순위: 4자리 연도 (2020~2030)
    match = re.search(r'(20[2-3][0-9])', title)
    if match:
        return int(match.group(1))

    # 2순위: 2자리 연도 (20~29)
    match = re.search(r'(\d{2})(?:년|학년)', title)
    if match:
        year = int(match.group(1))
        if 20 <= year <= 29:
            return 2000 + year

    return None  # 추출 실패
```

## 관련 메서드

### `Book.normalize_title(title, year)`
- 제목에서 연도를 제거하여 시리즈 비교에 사용
- `"2025 수능완성"` → `"수능완성"`

### `Book.extract_series(normalized_title)`
- 정규화된 제목에서 시리즈명 추출
- 괄호, 과목명, 권수 접미사 제거
- `"개념원리 수학(상)"` → `"개념원리 수학"`
- `"EBS 수능완성 국어영역"` → `"EBS 수능완성"`

### `Book.process_metadata()`
- `extract_year` → `normalize_title` → `extract_series` 순서로 자동 실행
- 도서 저장 시 메타데이터 자동 채움

## 처리 흐름

```
원본 제목: "2025 개념원리 수학(상)"
    ↓ extract_year()
year = 2025
    ↓ normalize_title(title, 2025)
normalized_title = "개념원리 수학(상)"
    ↓ extract_series()
normalized_series = "개념원리 수학"
```

## 성능

- **성공률:** 87% (981개 도서 기준)
- **실패 케이스:** 연도 정보가 없는 제목 (예: "수학의 정석")
- 실패 시 `year = None` → 묶음 대상에서 제외

## 관련 문서

- [[묶음-SKU-생성기]] - 연도별 묶음 그룹화에 사용
- [[알라딘-API-크롤러]] - 크롤링 시 자동 호출
- [[Database-Schema-V2]] - books 테이블의 year, normalized_title, normalized_series 컬럼
