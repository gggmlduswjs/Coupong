# 자동 크롤링 스케줄러

#feature #automation #scheduler

**상태:** ✅ 완료
**구현 파일:** `scripts/auto_crawl.py`, `start_auto_crawl.vbs`

---

## 개요

매일 새벽 3시에 전체 출판사 신간을 자동 크롤링하고 마진 분석을 수행하는 스케줄러.
신규 도서가 발견되면 대시보드 "신규 등록" 탭에 자동 반영됨.

## 구현 파일

| 파일 | 역할 |
|------|------|
| `scripts/auto_crawl.py` | 메인 스케줄러 (데몬 + 즉시실행) |
| `start_auto_crawl.vbs` | 숨김 실행 VBS (cmd 창 없이 실행) |
| `logs/auto_crawl.log` | 실행 로그 |

## 핵심 로직

### 실행 흐름

```
while True:
    if 현재시각 == 새벽 3시:
        1. FranchiseSync.crawl_by_publisher(max=50, year_filter=2025)
        2. FranchiseSync.analyze_products(신규 도서)
        3. 결과 로깅 (콘솔 + 파일 + Obsidian)
        4. 다음 날 3시까지 sleep
    else:
        30초 후 재확인
```

### 주요 기능

- **FranchiseSync 재활용**: 기존 크롤링+분석 엔진 그대로 사용
- **중복 방지**: ISBN 기준 DB 중복 체크 (FranchiseSync 내장)
- **year_filter=2025**: 2025년 이전 도서 자동 스킵
- **에러 격리**: 출판사 1개 실패해도 나머지 계속 진행
- **DB timeout=30**: 대시보드 동시 접근 시 SQLite 충돌 방지
- **Obsidian 자동 기록**: 크롤링 결과를 daily note에 기록

### CLI 옵션

```bash
python scripts/auto_crawl.py          # 데몬 모드 (새벽 3시)
python scripts/auto_crawl.py --now    # 즉시 실행 (테스트용)
python scripts/auto_crawl.py --hour 4 # 실행 시각 변경
```

## 자동 시작

Windows Startup 폴더에 VBS 등록:
- `CoupongDashboard.vbs` — 대시보드 (포트 8503)
- `CoupongAutoCrawl.vbs` — 자동 크롤링 (새벽 3시)

PC 부팅 시 두 프로세스 모두 백그라운드로 자동 시작.

## 관련 문서

- [[프랜차이즈-동기화]] — FranchiseSync 엔진 상세
- [[알라딘-API-크롤러]] — 알라딘 API 크롤링 상세
