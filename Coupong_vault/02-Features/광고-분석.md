# 광고 분석

#feature #광고 #ROAS #대시보드

**상태:** ✅ 완료
**구현 파일:** `dashboard.py`, `scripts/sync_ad_spend.py`, `app/models/ad_spend.py`

---

## 개요
쿠팡 광고비 정산 Excel 파일을 업로드하여 DB에 저장하고, 매출(revenue_history) 데이터와 크로스 분석하여 ROAS, 순이익 등 광고 효율을 시각화하는 대시보드 페이지.

## 구현 파일

### `app/models/ad_spend.py`
- `AdSpend` 모델 (ad_spends 테이블)
- UNIQUE(account_id, ad_date, campaign_id)로 중복 방지
- 주요 컬럼: billable_cost(실 광고비), vat_amount, total_charge, daily_budget 등

### `scripts/sync_ad_spend.py`
- `AdSpendSync` 클래스
- `parse_excel(filepath)` — openpyxl로 Excel 파싱
  - 요약행에서 날짜/VAT 추출, 상세행에서 캠페인별 데이터 추출
  - 파일명에서 vendor_id → accounts 테이블 매칭
- `save_to_db()` — INSERT OR REPLACE
- `sync_file()` — 단일 파일 파싱+저장
- CLI: `python scripts/sync_ad_spend.py path/to/excel.xlsx`

### `dashboard.py` (광고 페이지)
- **KPI 4개**: 총 광고비, 일평균 광고비, ROAS, 순이익
- **일별 추이 차트**: 광고비(bar) vs 매출(line) Plotly overlay
- **탭 3개**:
  - 일별 상세: 날짜별 광고비/매출/정산/ROAS 테이블
  - 캠페인별: 캠페인별 총광고비/운영일수/일평균 집계
  - ROI 분석: 광고비/매출 비율, 순이익률, 요일별 패턴

## 핵심 로직

### Excel 파싱
```
행 구조: 날짜 요약행 → 캠페인 상세행 교대
요약행: col1=날짜, col2=SELLER, col16=VAT, col17=총청구
상세행: col4=PA(광고유형), col6=캠페인ID, col15=청구가능광고비
```

### ROAS 계산
```sql
ROAS = SUM(revenue_history.sale_amount) / SUM(ad_spends.billable_cost)
순이익 = SUM(revenue_history.settlement_amount) - SUM(ad_spends.billable_cost)
```

## 관련 문서
- [[매출-분석]] - revenue_history 기반 매출 분석
- [[정산-내역-조회]] - settlement_history 기반 정산 분석
