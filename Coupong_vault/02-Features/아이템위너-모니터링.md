# 아이템 위너 모니터링

#feature #winner #monitoring

**상태:** ✅ 완료
**구현 파일:** `scripts/sync_item_winner.py`, `scripts/sync_coupang_products.py`, `dashboard.py`, `app/models/listing.py`

---

## 개요

쿠팡 WING API의 `get_product()` 응답에서 `items[].winner` 필드를 파싱하여 아이템 위너(Buy Box) 여부를 추적하는 시스템. 등록 완료 상품의 status 관리도 포함.

## 구현 파일

- `app/models/listing.py` — `winner_status`, `winner_checked_at`, `item_id` 컬럼
- `scripts/sync_coupang_products.py` — `_parse_detail_fields()`에서 winner 파싱, 마이그레이션
- `scripts/sync_item_winner.py` — 위너 전용 동기화 스크립트
- `dashboard.py` — KPI 표시, 상품 목록 위너 컬럼, 위너 확인 버튼

## 핵심 로직

### 1. 등록 완료 시 status 전환

```
신규 등록 루프에서 상품이 전 WING 계정에 등록 완료 →
products.status = 'uploaded' →
WHERE p.status = 'ready' 쿼리에서 자동 제외
```

### 2. 위너 판단 기준

```python
items[0].winner == True  → winner_status = 'winner'
items[0].winner == False → winner_status = 'not_winner'
winner 필드 없음         → winner_status = None (미확인)
```

### 3. 동기화 방법

- **자동**: `sync_coupang_products.py` Stage 2 상세 조회 시 함께 파싱
- **수동**: `python scripts/sync_item_winner.py` (위너만 집중 체크)
- **대시보드**: 상품관리 > "위너 확인" 버튼 (선택 계정 기준)

### 4. CLI 사용법

```bash
python scripts/sync_item_winner.py --dry-run           # API 응답 확인 (1건)
python scripts/sync_item_winner.py                      # 전체 위너 체크
python scripts/sync_item_winner.py --account 007-bm     # 특정 계정
python scripts/sync_item_winner.py --force               # 전체 재확인
python scripts/sync_item_winner.py --stale-hours 12      # 12시간 이상 지난 것만
```

## 관련 문서

- [[등록-완료-상품-관리]]
