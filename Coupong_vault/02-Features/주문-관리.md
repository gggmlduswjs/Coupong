# 주문 관리 시스템

#feature #주문 #발주서 #WING-API

**상태:** ✅ 완료
**구현 파일:** `scripts/sync_orders.py`, `app/models/order.py`, `dashboard.py`

---

## 개요
쿠팡 WING API의 발주서(Ordersheet) API를 연동하여 주문 데이터를 DB에 동기화하고,
대시보드에서 주문 현황 모니터링 및 배송 관리(상품준비중/송장업로드/취소)를 수행하는 시스템.

## 구현 파일

### 모델
- `app/models/order.py` — Order 모델 (orders 테이블)
  - UNIQUE: (account_id, shipment_box_id, vendor_item_id)
  - 인덱스: (account_id, ordered_at), (account_id, status), (order_id)

### API 클라이언트
- `app/api/coupang_wing_client.py` — 12개 주문 관련 메서드
  - 조회: get_ordersheets, get_all_ordersheets, get_ordersheet_by_shipment, get_ordersheet_by_order, get_ordersheet_history
  - 상태변경: acknowledge_ordersheets, upload_invoice, update_invoice, stop_shipment, complete_shipment, cancel_order, complete_long_term_undelivery

### 동기화 스크립트
- `scripts/sync_orders.py` — OrderSync 클래스
  - 상태별 조회 (ACCEPT → FINAL_DELIVERY)
  - 31일 윈도우 분할 + nextToken 자동 페이징
  - INSERT OR REPLACE 방식
  - listing 매칭 (seller_product_id / product_name)

### 대시보드
- `dashboard.py` — "주문" 페이지 (v3.7)
  - KPI: 총 주문 수, 총 매출액, 배송완료율, 취소/환불 건수
  - 일별 주문 추이 (Bar + Line 차트)
  - 탭1: 주문 목록 (AgGrid + CSV 다운로드)
  - 탭2: 상태별 분석 (Pie + Bar + 배송 소요시간)
  - 탭3: 배송 관리 (상품준비중/송장업로드/주문취소)

## 사용법

```bash
# 기본 (최근 7일)
python scripts/sync_orders.py

# 최근 30일
python scripts/sync_orders.py --days 30

# 특정 계정만
python scripts/sync_orders.py --account 007-book

# 특정 상태만
python scripts/sync_orders.py --status ACCEPT
```

## 관련 문서
- [[광고-분석]] - 광고비 ROI 분석
- [[코드-리뷰-자동화-시스템]] - 전체 시스템 구조
