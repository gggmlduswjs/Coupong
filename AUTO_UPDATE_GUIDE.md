# 출판사별 자동 업데이트 가이드

## 🎯 개요

24개 출판사의 최신 교재를 자동으로 검색하여 쿠팡 CSV를 생성하는 시스템입니다.

---

## 📋 취급 출판사 (24개)

| 출판사 | 매입률 | 무료배송 기준 |
|--------|--------|--------------|
| 마린북스, 아카데미소프트, 렉스미디어, 해람북스 | 40% | 9,000원 |
| 크라운, 영진 | 55% | 14,400원 |
| 이퓨쳐, 사회평론, 길벗, 아티오, 이지스퍼블리싱 | 60% | 18,000원 |
| 개념원리, 이투스, 비상교육, 능률교육, 씨톡, 지학사, 수경출판사, 쏠티북스, 마더텅, 한빛미디어 | 65% | 23,900원 |
| 동아 | 67% | 27,600원 |
| 좋은책신사고 | 70% | 35,800원 |
| EBS | 73% | 50,800원 |

---

## 🚀 사용 방법

### 방법 1: 수동 실행 (대화형)

```bash
python scripts/auto_search_publishers.py
```

**기능:**
- 출판사 선택 가능
- 검색 개수 설정
- 출간일 필터 설정
- 검색 결과 미리보기
- 확인 후 저장

**권장 상황:**
- 처음 사용할 때
- 특정 출판사만 검색하고 싶을 때
- 결과를 확인하고 싶을 때

---

### 방법 2: 완전 자동 실행 (스케줄링용)

```bash
python scripts/scheduled_auto_update.py
```

**기능:**
- 사용자 입력 없이 자동 실행
- 모든 출판사 검색
- 최근 180일 이내 도서만
- 무료배송 기준 자동 체크
- 로그 파일 자동 생성

**권장 상황:**
- Windows 작업 스케줄러 등록
- 매일 자동 업데이트
- 무인 운영

---

## ⏰ Windows 작업 스케줄러 설정

### 1단계: 작업 스케줄러 열기

```
Win + R → taskschd.msc
```

### 2단계: 새 작업 만들기

1. **일반 탭**
   - 이름: `쿠팡 도서 자동 업데이트`
   - 설명: `출판사별 최신 도서 자동 검색 및 CSV 생성`
   - 사용자 로그온 여부에 관계없이 실행 체크

2. **트리거 탭**
   - 새로 만들기 클릭
   - 시작: `예약`
   - 설정: `매일`
   - 시작 시간: `오전 9:00` (원하는 시간)
   - 사용: 체크

3. **작업 탭**
   - 새로 만들기 클릭
   - 프로그램/스크립트: `C:\Users\MSI\Desktop\Coupong\scripts\run_auto_update.bat`
   - 시작 위치: `C:\Users\MSI\Desktop\Coupong`

4. **조건 탭**
   - 컴퓨터의 전원이 AC 전원일 때만 시작: 해제
   - 컴퓨터가 배터리 전원을 사용할 경우 중지: 해제

5. **설정 탭**
   - 작업 실패 시 다시 시작 간격: `10분`
   - 다시 시작 시도 간격: `3회`

### 3단계: 테스트

1. 작업 선택
2. 우클릭 → 실행
3. `logs/` 폴더에서 로그 확인

---

## 🎛️ 설정 변경

### 검색 조건 수정

`scripts/scheduled_auto_update.py` 파일 상단의 `CONFIG` 변경:

```python
CONFIG = {
    "max_per_publisher": 20,        # 출판사당 최대 검색 개수
    "recent_days": 180,              # 최근 N일 이내 출간 도서만
    "min_price": 5000,               # 최소 가격
    "max_price": 100000,             # 최대 가격
}
```

### 출판사 추가/수정

`config/publishers.py` 파일의 `PUBLISHERS` 리스트 수정:

```python
{"name": "새출판사", "margin": 60, "min_free_shipping": 18000},
```

---

## 📊 시스템 동작 흐름

```
1. 알라딘 API 검색
   ↓
2. 출판사 필터링
   ↓
3. 최신도서 필터링 (최근 180일)
   ↓
4. 가격 범위 필터링 (5,000~100,000원)
   ↓
5. 무료배송 기준 체크
   ↓
6. DB 저장 (중복 제외)
   ↓
7. CSV 생성 (5개 계정)
   ↓
8. 로그 저장
```

---

## 📝 로그 확인

### 로그 파일 위치

```
logs/auto_update_20260205.log
```

### 로그 내용 예시

```
2026-02-05 09:00:01 - INFO - 출판사별 최신 도서 자동 업데이트 시작
2026-02-05 09:00:02 - INFO - [개념원리] 검색 중...
2026-02-05 09:00:05 - INFO -   ✓ 개념원리 수학 (상) (15,000원)
2026-02-05 09:00:06 - INFO -   ✓ 개념원리 알피엠 (12,000원)
...
2026-02-05 09:15:23 - INFO - 총 검색 결과: 127개
2026-02-05 09:15:30 - INFO - DB 저장 완료: 저장 43개, 건너뜀 84개
2026-02-05 09:15:35 - INFO - CSV 생성 완료
2026-02-05 09:15:35 - INFO - 자동 업데이트 완료: 43개 신규 저장
```

---

## 🔍 필터링 로직

### 1. 출판사 필터
- 취급 출판사 24개만 검색
- 출판사명 정확 매칭

### 2. 최신도서 필터
- 최근 180일 이내 출간
- 설정 변경 가능 (`recent_days`)

### 3. 가격 필터
- 최소: 5,000원
- 최대: 100,000원
- 너무 저렴하거나 비싼 도서 제외

### 4. 무료배송 필터
- 출판사별 무료배송 기준 체크
- 기준 미충족 시 자동 제외
- 예: 개념원리 → 판매가 23,900원 이상

---

## 💰 수익 계산

### 예시: 개념원리 수학 (정가 15,000원)

```
정가:      15,000원
판매가:    13,500원 (정가의 90%)
매입가:     5,250원 (정가의 35%, 매입률 65%)
쿠팡수수료: 1,350원 (판매가의 10%)

순수익 = 13,500 - 5,250 - 1,350 = 6,900원 (51% 마진)
```

### 출판사별 예상 마진

| 매입률 | 순수익 (판매가 대비) |
|--------|---------------------|
| 40%    | 50%                 |
| 55%    | 35%                 |
| 60%    | 30%                 |
| 65%    | 25%                 |
| 67%    | 23%                 |
| 70%    | 20%                 |
| 73%    | 17%                 |

---

## 📈 권장 운영 스케줄

### 일일 자동 업데이트
```
매일 오전 9시 - 자동 검색 및 CSV 생성
```

### 주간 수동 검토
```
매주 월요일:
1. 로그 파일 확인
2. 신규 등록된 도서 확인
3. 쿠팡 판매자센터 업로드
```

### 월간 분석
```
매월 1일:
1. 판매 데이터 분석
2. 출판사별 성과 확인
3. 전략 조정
```

---

## 🐛 트러블슈팅

### 문제 1: 검색 결과가 없음

**원인:**
- TTBKey 오류
- API 제한 초과

**해결:**
1. `.env` 파일에서 `ALADIN_TTB_KEY` 확인
2. 알라딘 API 제한 (일 5,000건) 확인
3. 로그 파일에서 오류 메시지 확인

---

### 문제 2: CSV 생성 안됨

**원인:**
- 새 도서가 없음 (모두 중복)
- DB 연결 오류

**해결:**
1. 로그에서 "저장된 새 도서가 없습니다" 확인
2. `recent_days` 값 늘리기 (예: 365일)
3. 데이터베이스 파일 확인

---

### 문제 3: 작업 스케줄러 실행 안됨

**원인:**
- 경로 오류
- 권한 문제

**해결:**
1. 배치 파일 경로 확인
2. "사용자 로그온 여부에 관계없이 실행" 체크
3. 관리자 권한으로 실행 설정

---

## 🎁 자동화의 장점

### 1. 시간 절약
- **수동:** 1일 2시간 → **자동:** 0시간
- 연간 730시간 절약

### 2. 최신성
- 매일 자동 업데이트
- 신간 즉시 등록

### 3. 일관성
- 동일한 기준으로 필터링
- 실수 방지

### 4. 확장성
- 출판사 추가 간단
- 설정 변경 쉬움

---

## 📚 다음 단계

### 1. 알라딘 TTBKey 발급
```
https://www.aladin.co.kr/ttb/wblog_manage.aspx
```

### 2. .env 파일에 키 입력
```
ALADIN_TTB_KEY=your_key_here
```

### 3. 테스트 실행
```bash
python scripts/auto_search_publishers.py
```

### 4. 작업 스케줄러 설정
```
매일 오전 9시 자동 실행
```

### 5. 쿠팡 업로드
```
data/uploads/ 폴더의 CSV 파일 업로드
```

---

## 🎉 완성!

이제 매일 자동으로 최신 교재가 검색되고 CSV가 생성됩니다.

**즐거운 자동 판매 되세요! 🚀**
